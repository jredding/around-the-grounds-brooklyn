---
id: WP02
title: Update all 7 parsers
lane: planned
depends_on: [WP01]
feature: 005-adapter-interface-update
---

# WP02 — Update all 7 parsers

## Goal
Migrate every concrete parser to construct `Event` objects directly with tz-aware `datetime_start`, replacing all `FoodTruckEvent` construction and `self.brewery.*` access.

## Context
- Upstream-first: clean PR to around-the-grounds main
- Minimalism: only parser type signatures and field names change — no logic, no structure
- Prerequisite: spec 004 merged to main before implementing
- Branch: `005-adapter-interface-update`

## Subtasks

### `stoup_ballard.py`
- [ ] Import: `FoodTruckEvent` → `Event`; add `PACIFIC_TZ` from `timezone_utils`
- [ ] `self.brewery.*` → `self.venue.*`: 7 occurrences
- [ ] 3 `FoodTruckEvent(...)` → `Event(...)` construction sites
- [ ] Timezone: `date=current_date` → `datetime_start=current_date.replace(tzinfo=PACIFIC_TZ)`
- [ ] `start_time` / `end_time` → `.replace(tzinfo=PACIFIC_TZ)` if not None
- [ ] `ai_generated_name=False` → `extraction_method="html"`

### `bale_breaker.py`
- [ ] Import: `FoodTruckEvent` → `Event`
- [ ] `self.brewery.*` → `self.venue.*`: 6 occurrences
- [ ] 2 `FoodTruckEvent(...)` → `Event(...)` construction sites
- [ ] Timezone: remove `.replace(tzinfo=None)` at the two `pacific_tz` conversion sites (result of `astimezone(pacific_tz)` is already tz-aware)
- [ ] Fallback event: `date=datetime.now()` → `datetime_start=datetime.now(ZoneInfo("America/Los_Angeles"))`
- [ ] `ai_generated_name=False` → `extraction_method="html"`

### `urban_family.py`
- [ ] Import: `from ..models import Brewery, FoodTruckEvent` → `from ..models import Venue, Event`
- [ ] **`__init__` override** (explicit, not inherited): `def __init__(self, brewery: Brewery) -> None:` → `def __init__(self, venue: Venue) -> None:`; `super().__init__(brewery)` → `super().__init__(venue)`
- [ ] `self.brewery.*` → `self.venue.*`: 7 occurrences
- [ ] 1 `FoodTruckEvent(...)` → `Event(...)` construction site
- [ ] Timezone: remove `.replace(tzinfo=None)` from `_parse_time_string()` ISO conversion; for 24-hour and 12-hour formats use `.replace(..., tzinfo=PACIFIC_TZ)` instead of naive
- [ ] `ai_generated=True` → `extraction_method="ai-vision"`; `False` → `extraction_method="html"`

### `obec_brewing.py`
- [ ] Import: `FoodTruckEvent` → `Event`; `now_in_pacific_naive` → `now_in_pacific`
- [ ] `self.brewery.*` → `self.venue.*`: 3 occurrences
- [ ] 1 `FoodTruckEvent(...)` → `Event(...)` construction site
- [ ] Timezone: `now_in_pacific_naive()` → `now_in_pacific()` throughout (result is already tz-aware, no `.replace(tzinfo=...)` needed)
- [ ] `ai_generated_name=False` → `extraction_method="html"`

### `chucks_greenwood.py`
- [ ] Import: `FoodTruckEvent` → `Event`; add `PACIFIC_TZ` from `timezone_utils`
- [ ] `self.brewery.*` → `self.venue.*`: 3 occurrences
- [ ] 1 `FoodTruckEvent(...)` → `Event(...)` construction site
- [ ] Timezone: `parse_date_with_pacific_context(...)` returns naive → add `.replace(tzinfo=PACIFIC_TZ)` to the result
- [ ] `ai_generated_name=False` → `extraction_method="html"`

### `salehs_corner.py`
- [ ] Import: `from ..models import Brewery, FoodTruckEvent` → `from ..models import Venue, Event`
- [ ] Import: `utc_to_pacific_naive` → `utc_to_pacific_aware`
- [ ] **`__init__` override** (explicit, not inherited): `def __init__(self, brewery: Brewery) -> None:` → `def __init__(self, venue: Venue) -> None:`; `super().__init__(brewery)` → `super().__init__(venue)`
- [ ] `self.brewery.*` → `self.venue.*`: 4 occurrences
- [ ] 1 `FoodTruckEvent(...)` → `Event(...)` construction site
- [ ] Timezone: `_parse_iso_timestamp()` — `utc_to_pacific_naive(...)` → `utc_to_pacific_aware(...)`
- [ ] `_parse_event_timestamps()` — `now_in_pacific_naive()` → `now_in_pacific()` for tz-homogeneous comparison
- [ ] `ai_generated_name=False` → `extraction_method="api"` (vendor names come from API, not HTML)

### `wheelie_pop.py`
- [ ] Import: `FoodTruckEvent` → `Event`; `utc_to_pacific_naive` → `utc_to_pacific_aware`
- [ ] `self.brewery.*` → `self.venue.*`: 3 occurrences
- [ ] 1 `FoodTruckEvent(...)` → `Event(...)` construction site
- [ ] Timezone: `_parse_time()` — `utc_to_pacific_naive(parsed)` → `utc_to_pacific_aware(parsed)`
- [ ] **`_event_key()` fix** (silent runtime breakage if missed): `event.date.strftime('%Y-%m-%d')` → `event.datetime_start.strftime('%Y-%m-%d')`; `event.food_truck_name.lower()` → `event.title.lower()`; `event.start_time` → `event.datetime_start` (for formatted time component)
- [ ] Type annotations at L25, L113, L126: `List[FoodTruckEvent]` → `List[Event]`
- [ ] `ai_generated_name=False` → `extraction_method="html"`

## Files to change
- `around_the_grounds/parsers/stoup_ballard.py`
- `around_the_grounds/parsers/bale_breaker.py`
- `around_the_grounds/parsers/urban_family.py`
- `around_the_grounds/parsers/obec_brewing.py`
- `around_the_grounds/parsers/chucks_greenwood.py`
- `around_the_grounds/parsers/salehs_corner.py`
- `around_the_grounds/parsers/wheelie_pop.py`

`parsers/registry.py` — NOT in scope, diff must be empty.

## Acceptance criteria
- `grep -r "FoodTruckEvent\|import.*Brewery\|from.*Brewery" around_the_grounds/parsers/` returns zero matches
- All `datetime_start=` arguments are tz-aware (carry `tzinfo`)
- `salehs_corner.py` uses `extraction_method="api"`
- `UrbanFamilyParser.__init__` and `SalehsCornerParser.__init__` both updated (not just `BaseParser.__init__`)
- `WheeliePopParser._event_key()` updated — `event.date`, `event.food_truck_name`, `event.start_time` all renamed
- `parsers/registry.py` diff is empty

## Reviewer notes
Per plan.md upstream PR checklist:
1. `grep -r "FoodTruckEvent\|import.*Brewery" around_the_grounds/parsers/` must return zero — if not, a parser was missed
2. Every `datetime_start=` argument is tz-aware (`tzinfo` present); `Event.__post_init__` catches this at runtime but tests should too
3. `UrbanFamilyParser.__init__` and `SalehsCornerParser.__init__` both updated — not just `BaseParser.__init__`
4. `WheeliePopParser._event_key()` updated — silent deduplication breakage if missed
5. `salehs_corner.py` uses `extraction_method="api"` — not `"html"`
6. `parsers/registry.py` diff is empty

Parsers may be committed individually within WP02. All 7 must pass WP03 audit before branch is merged.
