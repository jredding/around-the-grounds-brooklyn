---
id: WP01
title: JSON Schema + config loader
lane: planned
depends_on: []
feature: 006-multi-config-deployment
---

# WP01 — JSON Schema + config loader

## Goal
Introduce a JSON Schema file and a `loader.py` module that validates a venues config file and returns a typed `VenueList` dataclass.

## Context
- Upstream-first: clean PR to around-the-grounds main
- Minimalism: only config loading and CLI surface changes — no parser/scraper logic changes
- Prerequisite: spec 004 merged before implementing (Brewery model must exist)
- Branch: `006-multi-config-deployment`
- This WP blocks WP02, WP03, and WP04 — implement it first

## Subtasks
- [ ] Add `jsonschema>=4.0.0` to `[project].dependencies` in `pyproject.toml`
- [ ] Create directory `around_the_grounds/config/schemas/`
- [ ] Create `around_the_grounds/config/schemas/food-trucks-config.schema.json` with:
  - Required top-level: `list_name` (string), `target_repo` (string), `venues` (array, minItems: 1)
  - Optional top-level: `target_branch` (string, default `"main"`), `target_url` (string), `template_dir` (string)
  - Per venue required: `key` (string), `name` (string), `url` (string), `source_type` (enum: `html|ical|api`)
  - Per venue optional: `timezone` (string), `parser_config` (object)
  - Do NOT include `location` field — not used by food truck parsers
- [ ] Create `around_the_grounds/config/loader.py` with:
  - `VenueList` dataclass with fields: `list_name`, `venues: List[Brewery]`, `target_repo`, `target_branch = "main"`, `target_url: Optional[str]`, `template_dir: Optional[str]`
  - `ConfigValidationError(Exception)` class
  - `load_venue_list(config_path: Union[str, Path]) -> VenueList` function
  - Private `_validate_schema(data, path)` using jsonschema
  - Private `_deserialize(data) -> VenueList` mapping venues to `Brewery` instances
- [ ] Update `around_the_grounds/config/__init__.py` to export `VenueList`, `load_venue_list`, `ConfigValidationError`
- [ ] Run `uv sync --dev` to install jsonschema

## Files to change
- `pyproject.toml` — add `jsonschema>=4.0.0` to `[project].dependencies`
- `around_the_grounds/config/schemas/food-trucks-config.schema.json` — new file
- `around_the_grounds/config/loader.py` — new file
- `around_the_grounds/config/__init__.py` — add exports

## Acceptance criteria
- `python -c "from around_the_grounds.config.loader import load_venue_list, VenueList, ConfigValidationError"` succeeds with no error
- `python -c "import jsonschema"` succeeds
- Schema file is valid JSON and parseable by jsonschema
- `load_venue_list` raises `FileNotFoundError` for a missing path
- `load_venue_list` raises `ConfigValidationError` for a JSON file missing required fields

## Reviewer notes
- `settings.py` is NOT deleted — `VisionConfig` and `VisionConfig.from_env()` remain there; only `DEFAULT_GIT_REPOSITORY` and `get_git_repository_url` will be removed later in WP03/WP04
- `Brewery` model is unchanged — `VenueList.venues` wraps existing `List[Brewery]`
- `source_type` schema field is metadata for spec 005's use; parsers still dispatch via registry key
