---
id: WP04
title: Update Temporal layer
lane: planned
depends_on: [WP01, WP03]
feature: 006-multi-config-deployment
---

# WP04 — Update Temporal layer

## Goal
Remove `git_repository_url` from the Temporal workflow data model and update activities, workflows, and CLI entry points to source deployment target from the config file via `load_venue_list`.

## Context
- Upstream-first: clean PR to around-the-grounds main
- Minimalism: only config loading and CLI surface changes — no parser/scraper logic changes
- Prerequisite: spec 004 merged before implementing
- Branch: `006-multi-config-deployment`
- Depends on WP01 and WP03; blocks WP05

## Subtasks
- [ ] `temporal/shared.py`: remove `git_repository_url` field from `WorkflowParams`
- [ ] `temporal/shared.py`: remove `DEFAULT_GIT_REPOSITORY` import from `config.settings`
- [ ] `temporal/shared.py`: change `config_path: Optional[str] = None` → `config_path: str = ""`
- [ ] `temporal/activities.py`: replace `load_brewery_config` import with `load_venue_list` from `around_the_grounds.config.loader`
- [ ] `temporal/activities.py`: update `ScrapeActivities` config loading activity to call `load_venue_list(config_path)` and return `venue_list.venues` serialized
- [ ] `temporal/activities.py`: update `DeploymentActivities.deploy_to_git` to accept `config_path` in payload, call `load_venue_list(config_path)` to get `target_repo`, `target_branch`, and `template_dir`
- [ ] `temporal/activities.py`: replace hardcoded `Path.cwd() / "public_template"` with `template_dir` resolved from `VenueList`
- [ ] `temporal/activities.py`: replace hardcoded `"main"` branch string in git push with `venue_list.target_branch`
- [ ] `temporal/workflows.py`: remove `params.git_repository_url` from the `deploy_to_git` activity payload; pass `config_path: params.config_path` instead
- [ ] `temporal/starter.py`: remove `--git-repo` flag and `get_git_repository_url()` call
- [ ] `temporal/starter.py`: replace `--config` optional flag with required positional `venues_config` argument
- [ ] `temporal/starter.py`: remove `git_repository_url=...` from `WorkflowParams(...)` constructor
- [ ] `temporal/schedule_manager.py`: replace `--config` optional flag with required positional `venues_config` argument
- [ ] `temporal/schedule_manager.py`: update `WorkflowParams(config_path=config_path)` constructor call accordingly

## Files to change
- `around_the_grounds/temporal/shared.py` — remove `git_repository_url`, update `config_path` type
- `around_the_grounds/temporal/activities.py` — swap `load_brewery_config` for `load_venue_list`, remove hardcoded path/branch
- `around_the_grounds/temporal/workflows.py` — remove `git_repository_url` from deploy payload
- `around_the_grounds/temporal/starter.py` — remove `--git-repo`, change `--config` to positional
- `around_the_grounds/temporal/schedule_manager.py` — change `--config` to positional

## Acceptance criteria
- `grep -r "DEFAULT_GIT_REPOSITORY" around_the_grounds/temporal/` → zero matches
- `grep -r "git_repository_url" around_the_grounds/temporal/` → zero matches
- `grep -r "Path.cwd.*public_template" around_the_grounds/temporal/` → zero matches
- `grep -rn '"main"' around_the_grounds/temporal/` — no hardcoded branch strings remain in git push calls
- `grep -r "get_git_repository_url" around_the_grounds/temporal/` → zero matches

## Reviewer notes
- Temporal workflow structure (`FoodTruckWorkflow`, activity classes) is unchanged — only data flowing through it changes
- GitHub App auth logic inside activities is unchanged
- `config_path` changing from `Optional[str] = None` to `str = ""` makes the field required in practice — callers must now supply a valid path
- `settings.py` still exists; `VisionConfig` and `VisionConfig.from_env()` remain unaffected
